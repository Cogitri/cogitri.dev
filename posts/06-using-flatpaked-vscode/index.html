<!DOCTYPE html>
<html lang="en-gb">
<head>
    <meta charset="utf-8">
    <link crossorigin="anonymous" media="all"
        rel="stylesheet"
        href="https://www.cogitri.dev/css/frameworks.css" />
    <link crossorigin="anonymous" media="all"
        rel="stylesheet" href="https://www.cogitri.dev/css/github.css" />
    <meta name="viewport" content="width=device-width">

    <title>Using VSCode in a Flatpak - Cogitri&#39;s blog</title>

    <link rel="icon" type="image/x-icon" class="js-site-favicon" href="https://www.cogitri.dev/images/favicon.ico">
    <meta name="theme-color" content="#1e2327">
    
</head>

<body class="env-production emoji-size-boost page-responsive page-profile">
  <div class="position-relative js-header-wrapper ">
    <span class="Progress progress-pjax-loader position-fixed width-full js-pjax-loader-bar">
        <span class="progress-pjax-loader-bar top-0 left-0" style="width: 0%;"></span>
    </span>
    <header class="Header js-details-container Details flex-wrap flex-lg-nowrap p-responsive" role="banner">
        <div class="Header-item d-none d-lg-flex">
            <a class="Header-link" href="https://www.cogitri.dev" aria-label="Homepage"
                data-ga-click="Header, go to dashboard, icon:logo">
                <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
                    width="32" aria-hidden="true">
                    <path fill-rule="evenodd"
                        d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z" />
                </svg>
            </a>
        </div>
        <div
            class="Header-item Header-item--full flex-column flex-lg-row width-full flex-order-2 flex-lg-order-none mr-0 mr-lg-3 mt-3 mt-lg-0 Details-content--hidden">
            <div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 scoped-search site-scoped-search js-site-search position-relative js-jump-to"
                role="combobox" aria-owns="jump-to-results" aria-label="Search or jump to" aria-haspopup="listbox"
                aria-expanded="false">
                <div class="position-relative">
                </div>
            </div>
        </div>
        <div class="Header-item Header-item--full flex-justify-center d-lg-none position-relative" style="margin-right: auto;">
            <a class="Header-link" href="https://www.cogitri.dev" aria-label="Homepage"
                data-ga-click="Header, go to dashboard, icon:logo">
                <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
                    width="32" aria-hidden="true">
                    <path fill-rule="evenodd"
                        d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z" />
                </svg>
            </a>
        </div>
        <div class="Header-item position-relative mr-0 d-none d-lg-flex">
            <details class="details-overlay details-reset">
                <summary class="Header-link" aria-label="View profile and more"
                    data-ga-click="Header, show menu, icon:avatar">
                    
                    <img alt="" class="avatar" src="https://avatars1.githubusercontent.com/u/8766773?s=460&amp;v=4" height="20" width="20">
                    
                </summary>
            </details>
        </div>
    </header>
</div>

<div id="start-of-content" class="show-on-focus"></div>
<div id="js-flash-container">
</div>

  
<div class="application-main " data-commit-hovercards-enabled="">
    <div itemscope="" itemtype="http://schema.org/SoftwareSourceCode" class="">
        <main id="js-repo-pjax-container" data-pjax-container="">
            <div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav pt-0 pt-lg-4 ">
                <div class="repohead-details-container clearfix container-lg p-responsive d-none d-lg-block">
                    <div class="mb-3 d-flex">
                        <h1 class="public css-truncate float-none flex-auto width-fit pl-0">
                            <a class="avatar mr-1" href="https://www.cogitri.dev/about/">
                            

                                <img
                                    src="https://avatars1.githubusercontent.com/u/8766773?s=460&amp;v=4" width="26" height="26">
                            
                            </a>
                            <span class="author"><a
                                    href="https://www.cogitri.dev">Rasmus Thomsen</a></span>
                            <span class="path-divider">/</span>
                            <strong itemprop="name" class="css-truncate-target" style="max-width: 410px"><a
                                    href="https://www.cogitri.dev/posts/06-using-flatpaked-vscode/">Using VSCode in a Flatpak</a></strong>

                            <div class="d-block text-small text-gray">
                                Created <time-ago datetime="2020-03-27" class="no-wrap"
                                    title="Created at 2020/03/27">
                                    2020-03-27</time-ago>
                                <span class="file-info-divider"></span>
                                Modifyed <time-ago datetime="2020-03-27" class="no-wrap"
                                    title="Modifyed  at 2020/03/27">
                                    2020-03-27</time-ago>
                            </div>
                        </h1>
                    </div>
                </div>




            </div>
            <div class="container-lg clearfix new-discussion-timeline experiment-repo-nav  p-responsive">
                <div class="repository-content ">
                    <div class="Box mt-3 position-relative">
                        <div class="Box-header py-2 d-flex flex-column flex-shrink-0 flex-md-row flex-md-items-center">
                            <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                                739 Words
                                
                            </div>
                        </div>

                        <div id="readme" class="Box-body readme blob instapaper_body js-code-block-container">
                            <article class="markdown-body entry-content p-3 p-md-6" itemprop="text"><p>I&rsquo;ve recently started using VSCode as my main editor, mainly due to its
extensibility, meaning I can use it in almost all scenarios (at work, for
personal projects, &hellip;) and it&rsquo;s easy to customize to my needs (although the
defaults are pretty nice already). However, since it uses Electron (which
currently still needs glibc, <a href="https://github.com/electron/electron/issues/9662#issuecomment-591719521">although that might change soon</a>)
I currently need to run it in a Flatpak, which needed some setup in order
to be suitable for development</p>
<h1 id="setting-up-dependencies">Setting up dependencies</h1>
<p>Overall, there are two ways to do this: The (somewhat) quick and messy way
and the less quick but <em>way</em> nicer way.</p>
<h2 id="the-messy-way">The messy way</h2>
<p>Flatpak mounts folders in its / read-only, so you don&rsquo;t mess with it, so you
can&rsquo;t really install deps there, unless you bindmount a folder into the VSCode
flatpak, like so:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flatpak override --filesystem<span style="color:#f92672">=</span>/packages com.visualstudio.Code
</code></pre></div><p>Alternatively you could also use one of the folders in your $HOME, since the
VSCode flatpak permits full access to $HOME through the sandbox. You can now
build packages and install them to your new folder (which boils down to downloading the tarball, runing
<code>./configure --prefix=/packages &amp;&amp; make install</code> or <code>meson --prefix=/packages build &amp;&amp; ninja -C build install</code>
or something along those lines). Afterwards you have to adjust some environment
variables so that VSCode is able to find your new libs:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flatpak override --env<span style="color:#f92672">=</span>LD_LIBRARY_PATH<span style="color:#f92672">=</span>/packages/lib --env<span style="color:#f92672">=</span>LIBRARY_PATH<span style="color:#f92672">=</span>/packages/lib --env<span style="color:#f92672">=</span>PKG_CONFIG_PATH<span style="color:#f92672">=</span>/packages/lib --env<span style="color:#f92672">=</span>GETTEXTDATADIRS<span style="color:#f92672">=</span>/packages/share/gettext
</code></pre></div><p>The disadvantage of this method is that it&rsquo;s not really reproducible (which is annoying
if you have multiple systems), prone to breaking and while it is easy to setup it
will probably be more annoying in the long run when updating packages</p>
<h2 id="the-less-messy-way">The less messy way</h2>
<p>It&rsquo;s possible to create so called Sdk-Extensions which can then be used in your Flatpak.
This means creating a build recipe in a YML file and building it with <code>flatpak-builder</code>
and installing it. A simple build recipe which only builds one package could look like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#75715e"># app-id, you can set this to whatever if you want to</span>
<span style="color:#66d9ef">app-id</span>: org.freedesktop.Sdk.Extension.Cogitri
<span style="color:#75715e"># The branch this extension is for. Make sure to keep this in sync with</span>
<span style="color:#75715e"># runtime-version</span>
<span style="color:#66d9ef">branch</span>: <span style="color:#e6db74">&#39;19.08&#39;</span>
<span style="color:#66d9ef">runtime</span>: org.freedesktop.Sdk
<span style="color:#75715e"># What version the runtime we build against has. Make sure this is the same</span>
<span style="color:#75715e"># version as VSCode uses!</span>
<span style="color:#66d9ef">runtime-version</span>: <span style="color:#e6db74">&#39;19.08&#39;</span>
<span style="color:#66d9ef">sdk</span>: org.freedesktop.Sdk
<span style="color:#66d9ef">build-extension</span>: <span style="color:#66d9ef">true</span>
<span style="color:#66d9ef">build-options</span>:
  <span style="color:#75715e"># We want to install to this dir. This is passed to CMake/Meson/Configure etc.</span>
  <span style="color:#75715e"># if you set the `buildsystem` (see below in the vte module)</span>
  <span style="color:#66d9ef">prefix</span>: /usr/lib/sdk/Cogitri
  <span style="color:#75715e"># This is only required if one of the dependencies you build needs a binary from</span>
  <span style="color:#75715e"># another package you build in this module</span>
  <span style="color:#66d9ef">prepend-path</span>: /usr/lib/sdk/Cogitri/bin
  <span style="color:#75715e"># Same as above, but for libraries instead of binaries</span>
  <span style="color:#66d9ef">prepend-ld-library-path</span>: /usr/lib/sdk/Cogitri/lib
<span style="color:#66d9ef">modules</span>:
  <span style="color:#75715e"># It&#39;s best to make one module here for every dependencies you need, since flatpak</span>
  <span style="color:#75715e"># caches per-module: If you bump the dependency of one module you don&#39;t need to</span>
  <span style="color:#75715e"># rebuild everything then</span>
  - <span style="color:#66d9ef">name</span>: vte2<span style="color:#ae81ff">.91</span>
    <span style="color:#66d9ef">buildsystem</span>: meson
    <span style="color:#66d9ef">config-opts</span>:
      - -Ddocs=<span style="color:#66d9ef">false</span>
      - -Dvapi=<span style="color:#66d9ef">false</span>
    <span style="color:#66d9ef">build-options</span>:
      <span style="color:#66d9ef">env</span>: { <span style="color:#66d9ef">CXXFLAGS</span>: <span style="color:#e6db74">&#34;-fno-exceptions&#34;</span> }
    <span style="color:#66d9ef">sources</span>:
      - <span style="color:#66d9ef">type</span>: archive
        <span style="color:#66d9ef">url</span>: https://download.gnome.org/sources/vte/<span style="color:#ae81ff">0.58</span>/vte<span style="color:#ae81ff">-0.58.3</span>.tar.xz
        <span style="color:#66d9ef">sha256</span>: 22dcb54ac2ad1a56ab0a745e16ccfeb383f0b5860b5bfa1784561216f98d4975
</code></pre></div><p>See <a href="https://jlk.fjfi.cvut.cz/arch/manpages/man/flatpak-manifest.5.en">man 5 flatpak-manifest</a> for
more information. See <a href="https://github.com/Cogitri/org.freedesktop.Extension.Cogitri/blob/master/org.freedesktop.Sdk.Extension.Cogitri.yml">my GitHub repo</a> for how I made my build recipe.</p>
<p>Once you&rsquo;re done adding all packages to your build recipe it&rsquo;s time to build it like this:</p>
<pre><code>flatpak-builder --user --install --force-clean app org.freedesktop.Sdk.Extension.Cogitri.yml
</code></pre><p>This will build and install your extension for you. The only thing that&rsquo;s left now is to adjust
your paths:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flatpak override --env<span style="color:#f92672">=</span>LD_LIBRARY_PATH<span style="color:#f92672">=</span>/usr/lib/sdk/Cogitri/lib --env<span style="color:#f92672">=</span>LIBRARY_PATH<span style="color:#f92672">=</span>/usr/lib/sdk/Cogitri/lib --env<span style="color:#f92672">=</span>PKG_CONFIG_PATH<span style="color:#f92672">=</span>/usr/lib/sdk/Cogitri/lib --env<span style="color:#f92672">=</span>GETTEXTDATADIRS<span style="color:#f92672">=</span>/usr/lib/sdk/Cogitri/share/gettext
</code></pre></div><p>And now your dependencies should be available in your flatpak! :)</p>
<h3 id="updating-dependencies">Updating dependencies</h3>
<p>Updating dependencies is pretty easy with this approach. For example if I want to bump vte2.91
to version 0.60.0 I only need to change two things: the <code>url</code> to point at <code>0.60.0</code> instead of
<code>0.58.3</code> and the <code>sha256</code> to be the sha256sum of the new tarball. Flatpak has some fancy tool
to automatically update the sha256sum for you, but I forgot it&rsquo;s name - and <code>curl $url | sha256sum</code>
does the trick for now :)
After updating your build recipe simple re-run flatpak-builder like above. Since flatpak will only
rebuild changed modules (and modules that are built after that module, in case the other modules
need the changes of that new module) it shouldn&rsquo;t take as long as the initial build. It&rsquo;s a good
idea to place dependencies which are updated often to at the end of the file, so you don&rsquo;t have
to rebuild as many modules when bumping it.</p></article>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>



  <div class="footer container-lg width-full p-responsive" role="contentinfo">
    <div
        class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
        <ul
            class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
            <li class="mr-3 mr-lg-0">© 2019. Theme by <a href="https://github.com/MeiK2333/github-style"><span>github-style</span></a></li>
        </ul>

        <a aria-label="Homepage" title="Cogitri&#39;s blog" class="footer-octicon d-none d-lg-block mx-lg-4"
            href="https://www.cogitri.dev">
            <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24"
                aria-hidden="true">
                <path fill-rule="evenodd"
                    d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
                </path>
            </svg>
        </a>
        <ul
            class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
        </ul>
    </div>
    <div class="d-flex flex-justify-center pb-6">
        <span class="f6 text-gray-light"></span>
    </div>
</div>

<script crossorigin="anonymous"
    type="application/javascript" src="https://www.cogitri.dev/js/frameworks.js"></script>

<script crossorigin="anonymous" async="async"
    type="application/javascript" src="https://www.cogitri.dev/js/github-bootstrap.js"></script>
<script>
    let classs = ['pinned-item-desc', 'text-gray', 'text-small', 'd-block', 'mt-2', 'mb-3'];
    const pinned_posts = document.getElementsByName('pinned-post');
    for (let i = 0; i < pinned_posts.length; i++) {
        for (let j = 0; j < classs.length; j++) {
            const ps = pinned_posts[i].getElementsByTagName('p');
            for (let k = 0; k < ps.length; k++) {
                ps[k].classList.add(classs[j]);
            }
        }
    }
    classs = [ 'd-inline-block', 'text-gray', 'mb-2', 'pr-4'];
    const posts_posts = document.getElementsByName('posts-post');
    for (let i = 0; i < posts_posts.length; i++) {
        for (let j = 0; j < classs.length; j++) {
            const ps = posts_posts[i].getElementsByTagName('p');
            for (let k = 0; k < ps.length; k++) {
                ps[k].classList.add(classs[j]);
            }
        }
    }
</script>
</body>

</html>